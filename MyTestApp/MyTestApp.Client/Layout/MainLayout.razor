@inject IAuthenticationService authenticationService
@inherits LayoutComponentBase
@inject NavigationManager navigationManager

<MudThemeProvider IsDarkMode = "@_isDarkMode"/>
<MudPopoverProvider />
<MudDialogProvider />
<MudSnackbarProvider />

<MudLayout>
  <MudAppBar Elevation="1">
    <MudIconButton Icon="@Icons.Material.Filled.Menu" Color="Color.Inherit" Edge="Edge.Start" OnClick="@((e) => DrawerToggle())" />

    <MudText Typo="Typo.h6" Class="ml-3">TestApp</MudText>

    <MudSpacer />
    <MudToggleIconButton @bind-Toggled="@_isDarkMode"
                         Icon="@Icons.Material.Filled.DarkMode" Color="Color.Inherit"
                         ToggledIcon="@Icons.Material.Filled.LightMode" ToggledColor="Color.Inherit" />
    <AuthorizeView>
      <Authorized>
        <div class="d-flex align-center">
          <div class="d-flex flex-column align-end mr-3">
            <MudText Typo="Typo.body2" Style="font-weight: 600;">@context.User.Identity?.Name</MudText>
            <MudText Typo="Typo.caption" Color="Color.Inherit" Style="opacity: 0.7;">
              @context.User.FindFirst("Position")?.Value
            </MudText>
          </div>
          <MudMenu AnchorOrigin="Origin.BottomRight" TransformOrigin="Origin.TopRight">
            <ActivatorContent>
              <MudAvatar Color="Color.Warning" Variant="Variant.Filled">
                <MudIcon Color="Color.Dark" Icon="@Icons.Custom.Uncategorized.Radioactive" Size="Size.Large" />
              </MudAvatar>
            </ActivatorContent>
            <ChildContent>
              <MudMenuItem Icon="@Icons.Material.Filled.Person" Class="py-2">Profilim</MudMenuItem>
              <MudDivider />
              <MudMenuItem Icon="@Icons.Material.Filled.Logout" OnClick="Logout" IconColor="Color.Error">
                Güvenli Çıkış
              </MudMenuItem>
            </ChildContent>
          </MudMenu>
        </div>
      </Authorized>
    </AuthorizeView>
  </MudAppBar>

  <MudDrawer @bind-Open="@_drawerOpen" Elevation="2">
    <NavMenu />
  </MudDrawer>

  <MudMainContent>
    <MudContainer MaxWidth="MaxWidth.Large" Class="mt-4">
      @Body
    </MudContainer>
  </MudMainContent>
</MudLayout>

@code {
  bool _drawerOpen = true;
  static public bool _isDarkMode = true;

  void DrawerToggle() => _drawerOpen = !_drawerOpen;

  async Task Logout()
  {
    await authenticationService.Logout();

    navigationManager.NavigateTo("/login", true);
  }
}